---
- name: Converge
  hosts: all
  become: true

  vars:
    # Ansible Role: RHSM
    rhsm_username: "{{ lookup('env', 'RHSM_USERNAME') }}"
    rhsm_password: "{{ lookup('env', 'RHSM_PASSWORD') }}"
    rhsm_auto_attach: true
    rhsm_server_proxy_hostname: "{{ lookup('env', 'http_proxy_hostname') }}"
    rhsm_server_proxy_port: "{{ lookup('env', 'http_proxy_port') }}"
    rhsm_server_proxy_user: "{{ lookup('env', 'http_proxy_user') }}"
    rhsm_server_proxy_password: "{{ lookup('env', 'http_proxy_password') }}"
    rhsm_consumer_name: "nycrecords_{{ '%Y%m%d_%H%M%s' | strftime(ansible_date_time.epoch) }}"

    # Ansible Role: NodeJS
    use_scl: true
    nodejs_install_npm_user: root
    npm_config_prefix: /opt/rh/rh-nodejs12/root/usr
    npm_config_unsafe_perm: "true"
    nodejs_npm_global_packages:
      - node-sass
      - name: jslint
        version: 0.12.0
      - name: yo

  roles:
    - role: nycrecords.rhsm
    - role: ansible-role-nodejs
